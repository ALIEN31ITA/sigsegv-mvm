# vim: set sts=2 ts=8 sw=2 tw=99 et ft=python:
import os, sys

projectName = 'sigsegv'

# smsdk_ext.cpp will be automatically added later
sourceFiles = [
  'src/common.h',
  os.path.join(Extension.sm_root, 'public', 'asm', 'asm.c'),
  'src/sm/detours.cpp',
  'src/sm/MemoryUtils.cpp',
#  'src/sdk2013/debugoverlay_shared.cpp',
  'src/common.cpp',
  'src/sizeof.cpp',
  'src/extension.cpp',
  'src/client.cpp',
  'src/gameconf.cpp',
  'src/library.cpp',
  'src/disasm/disasm.cpp',
  'src/addr/addr.cpp',
  'src/addr/standard.cpp',
  'src/addr/prescan.cpp',
  'src/addr/misc.cpp',
  'src/mem/patch.cpp',
  'src/mem/scan.cpp',
  'src/prop.cpp',
  'src/util/trace.cpp',
  'src/util/backtrace.cpp',
  'src/util/rtti.cpp',
  'src/util/prof.cpp',
  'src/stub/baseentity.cpp',
  'src/stub/debugoverlay.cpp',
  'src/stub/gamerules.cpp',
  'src/stub/misc.cpp',
  'src/stub/nav.cpp',
  'src/stub/populators.cpp',
  'src/stub/tfplayer.cpp',
  'src/stub/tfbot.cpp',
  'src/stub/projectiles.cpp',
  'src/stub/tfrevivemarker.cpp',
  'src/stub/tfweaponbase.cpp',
  'src/stub/tf_objective_resource.cpp',
  'src/link/link.cpp',
  'src/link/nextbot1.cpp',
  'src/link/nextbot2.cpp',
  'src/mod.cpp',
  'src/mod/ai/engiebot_nopush.cpp',
  'src/mod/ai/improved_useitem.cpp',
  'src/mod/ai/lookat_oneplayer.cpp',
  'src/mod/ai/wrapassassin_altfire.cpp',
  'src/mod/attr/undocumented.cpp',
  'src/mod/bot/medieval_nonmelee.cpp',
  'src/mod/bot/multiclass_weapon.cpp',
  'src/mod/credits/spawn_autocollect.cpp',
  'src/mod/debug/overlay_recv.cpp',
  'src/mod/debug/overlay_send.cpp',
  'src/mod/debug/penetration.cpp',
  'src/mod/debug/revive_fast.cpp',
  'src/mod/debug/suicide_bomber.cpp',
  'src/mod/debug/usermsg_overflow.cpp',
  'src/mod/demo/stringtable_limit.cpp',
  'src/mod/pop/eventpopfile_improvements.cpp',
  'src/mod/pop/extattr/parse.cpp',
  'src/mod/pop/extattr/alwaysfireweaponalt.cpp',
  'src/mod/pop/extattr/targetstickies.cpp',
  'src/mod/pop/kv_conditional.cpp',
  'src/mod/pop/nested_complex_spawners.cpp',
  'src/mod/pop/popmgr_extensions.cpp',
  'src/mod/robot/standable_heads.cpp',
  'src/mod/robot/ticklish.cpp',
  'src/mod/sniper/charge_uncap.cpp',
  'src/mod/sniper/head_uncap.cpp',
  'src/mod/visualize/airblast.cpp',
  'src/mod/visualize/explosive_headshot.cpp',
  'src/mod/visualize/minigun_deflect.cpp',
]

###############
# Make sure to edit PackageScript, which copies your files to their appropriate locations
# Simple extensions do not need to modify past this point.

project = Extension.HL2Project(builder, projectName + '.ext')

if os.path.isfile(os.path.join(builder.currentSourcePath, 'src', 'sdk', 'smsdk_ext.cpp')):
  # Use the copy included in the project
  project.sources += [os.path.join('src', 'sdk', 'smsdk_ext.cpp')]
else:
  # Use the copy included with SM 1.6 and newer
  project.sources += [os.path.join(Extension.sm_root, 'public', 'smsdk_ext.cpp')]

project.sources += sourceFiles

for sdk_name in Extension.sdks:
  sdk = Extension.sdks[sdk_name]
  
  binary = Extension.HL2Config(project, projectName + '.ext.' + sdk.ext, sdk)


binary.compiler.cflags += [ '-include', 'common.h' ]

binary.compiler.linkflags += [
  '-liberty',
  '-lunwind',
  '-lunwind-x86',
  os.path.join(builder.currentSourcePath, 'libs', 'capstone', 'libcapstone.a'),
]

Extension.extensions = builder.Add(project)
